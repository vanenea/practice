<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>WEB</title>
	<link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.3/style/weui.min.css">
	<link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.1/css/jquery-weui.min.css">
</head>
<body>
	<div id="app"></div>
	<script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
	<script src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/jquery-weui.min.js"></script>
	<script src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/swiper.min.js"></script>
	<script type="text/javascript" src="js/hammer.js"></script>
	<script type="text/javascript" src="https://cdn.bootcss.com/vConsole/3.3.0/vconsole.min.js"></script>
	<script type="text/javascript">
		
		  // 初始化
		var vConsole = new VConsole();
		var app = document.getElementById("app");
		var hammer = new Hammer(app);
		/* hammertime.get('pan').set({ direction: Hammer.DIRECTION_ALL });
		hammertime.get('swipe').set({ direction: Hammer.DIRECTION_VERTICAL }); */
		
		hammer.on('pan panleft panright tap press', function(ev) {
			console.log(ev);
			sendMsg(ev.type+","+ev.deltaX+","+ev.deltaY)
		});	
	
		var websocket ;
		var url=window.location.href.replace("picture.html","websocket").replace("http","ws");
		//判断当前浏览器是否支持WebSocket
		if ('WebSocket' in window) {
			websocket = new WebSocket(url);
		} else {
			alert("不支持WEBSOCKET")
		};
	
		//连接发生错误的回调方法
		websocket.onerror = function() {
			setMessageInnerHTML("error");
		};
	
		//连接成功建立的回调方法
		 websocket.onopen = function(event){
		};
	
		//接收到消息的回调方法
		websocket.onmessage = function(event) {
			setMessageInnerHTML(event.data)
			addEvent(event.data);
		};
	
		//连接关闭的回调方法
		websocket.onclose = function() {
			setMessageInnerHTML("断开连接，对方将不再收到你的消息");
		};
	
		//监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。
		window.onbeforeunload = function() {
			websocket.close();
		};
		function sendMsg(msg){
			websocket.send(msg);
		}
		
		function setMessageInnerHTML(message) {
			console.log(message);
		}
		
		function addEvent(msg){
			var instruct = msg.split(",");
			app.style.left = instruct[1]+"px";
			app.style.top = instruct[2]+"px";
			
		}
		function getUrlString(name){
			var reg = new RegExp("(^|\\?|&)"+name+"=([^&]*)(\\s|&|$)","i");
			if(reg.test(decodeURI(location.href)))
			return unescape(RegExp.$2.replace(/\+/g," "));
		}
		
		var photo = $.photoBrowser({
			items: [
			  "//gqianniu.alicdn.com/bao/uploaded/i4//tfscom/i1/TB1n3rZHFXXXXX9XFXXXXXXXXXX_!!0-item_pic.jpg_320x320q60.jpg",
			  "//gqianniu.alicdn.com/bao/uploaded/i4//tfscom/i4/TB10rkPGVXXXXXGapXXXXXXXXXX_!!0-item_pic.jpg_320x320q60.jpg",
			  "//gqianniu.alicdn.com/bao/uploaded/i4//tfscom/i1/TB1kQI3HpXXXXbSXFXXXXXXXXXX_!!0-item_pic.jpg_320x320q60.jpg"
			],
			onSlideChange: function(index){
			 console.log(index);
			}
		});
		photo.open();
	</script>
</body>
</html>